"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9575],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),d=l(n),m=i,h=d["".concat(c,".").concat(m)]||d[m]||u[m]||r;return n?o.createElement(h,s(s({ref:t},p),{},{components:n})):o.createElement(h,s({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=d;var a={};for(var c in t)hasOwnProperty.call(t,c)&&(a[c]=t[c]);a.originalType=e,a.mdxType="string"==typeof e?e:i,s[1]=a;for(var l=2;l<r;l++)s[l]=n[l];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},791:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return a},metadata:function(){return c},toc:function(){return l},default:function(){return u}});var o=n(2122),i=n(9756),r=(n(7294),n(3905)),s=["components"],a={title:"process",description:"Specification of the process.rs module",keywords:["development","developers","lido","specification","intent","process","solido","solana"],sidebar_position:11},c={unversionedId:"development/specification/solido/processor",id:"development/specification/solido/processor",isDocsHomePage:!1,title:"Process",description:"Specification of the process.rs module",source:"@site/docs/development/specification/solido/processor.md",sourceDirName:"development/specification/solido",slug:"/development/specification/solido/processor",permalink:"/development/specification/solido/processor",version:"current",sidebarPosition:11,frontMatter:{title:"process",description:"Specification of the process.rs module",keywords:["development","developers","lido","specification","intent","process","solido","solana"],sidebar_position:11},sidebar:"solidoSidebar",previous:{title:"Process Management",permalink:"/development/specification/solido/process_management"},next:{title:"State",permalink:"/development/specification/solido/state"}},l=[{value:"Functions",id:"functions",children:[{value:"process_initialize",id:"process_initialize",children:[]},{value:"process_deposit",id:"process_deposit",children:[]},{value:"process_stake_deposit",id:"process_stake_deposit",children:[]},{value:"process_withdraw",id:"process_withdraw",children:[]},{value:"process",id:"process",children:[]}]}],p={toc:l};function u(e){var t=e.components,n=(0,i.Z)(e,s);return(0,r.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Following the Solana convention, this module contains the processing logic of the on-chain program."),(0,r.kt)("h2",{id:"functions"},"Functions"),(0,r.kt)("h3",{id:"process_initialize"},"process_initialize"),(0,r.kt)("p",null,"This is the function that initializes the state of Solido."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn process_initialize(\n    version: u8,\n    program_id: &Pubkey,\n    fee_distribution: FeeDistribution,\n    max_validators: u32,\n    max_maintainers: u32,\n    accounts_raw: &[AccountInfo],\n) -> ProgramResult {\n\n")),(0,r.kt)("p",null,"This function completes a number of checks:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"confirms the Solido account is rent exempt"),(0,r.kt)("li",{parentName:"ul"},"confirms the reserve account is rent exempt"),(0,r.kt)("li",{parentName:"ul"},"checks that the size of the Solido data is the same as expected given the constraints of ",(0,r.kt)("inlineCode",{parentName:"li"},"max_maintainers"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"max_validators")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"LIDO_CONSTANT_SIZE"))),(0,r.kt)("p",null,"Once those checks are complete the function then finds the bump seeds associated with the ",(0,r.kt)("inlineCode",{parentName:"p"},"RESERVE_AUTHORITY")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"DEPOSIT_AUTHORITY")," for the defined ",(0,r.kt)("a",{parentName:"p",href:"/development/specification/solido/lib#Constants"},"constants"),", constructs the fee spec, checks that the ",(0,r.kt)("inlineCode",{parentName:"p"},"treasury_account")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"developer_account")," are valid stSOL accounts and finally then builds and serializes the state of Solido."),(0,r.kt)("h3",{id:"process_deposit"},"process_deposit"),(0,r.kt)("p",null,"This function is responsible for taking SOL deposits and minting the equivalent stSOL to the depositors receiving account."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn process_deposit(\n    program_id: &Pubkey,\n    amount: Lamports,\n    accounts_raw: &[AccountInfo],\n) -> ProgramResult {\n")),(0,r.kt)("p",null,"The recipient account must be capable of holding stSOL.  The deposit is transferred from the users account to the reserve account and, after checking the correct amount of equivalent stSOL, these are minted to the recipient account.  The total stSOL shares is updated and the new Solido state is serialized."),(0,r.kt)("h3",{id:"process_stake_deposit"},"process_stake_deposit"),(0,r.kt)("p",null,"The process stake deposit function is responsible for creating validator stake account and delegating reserve funds to those accounts."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn process_stake_deposit(\n    program_id: &Pubkey,\n    amount: Lamports,\n    raw_accounts: &[AccountInfo],\n) -> ProgramResult {\n")),(0,r.kt)("p",null,"This function is gated  so that only those in a maintainer role can run it successfully.  The function must check that the following are true:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the amount being staked is greater than the minimum stake balance"),(0,r.kt)("li",{parentName:"ul"},"the amount being staked is less then the available reserve balance")),(0,r.kt)("p",null,"Once those checks have been passed the function will try to find a stake address associated to the given validator and confirm that the account is uninitialized. The account is then allocated, assigned, the given amount is transferred to the account from the reserve. The account is then initialized and the amount is then delegated to the validator. Finally the validator stake amount is updated in the Solido state and the state is then serialized."),(0,r.kt)("h3",{id:"process_withdraw"},"process_withdraw"),(0,r.kt)("p",null,"This function processes a withdrawal."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note: Withdrawals are currently not supported in Solido; they will be added in a subsequent version.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn process_withdraw(\n    _program_id: &Pubkey,\n    _pool_tokens: StLamports,\n    _accounts: &[AccountInfo],\n) -> ProgramResult {\n")),(0,r.kt)("h3",{id:"process"},"process"),(0,r.kt)("p",null,"This is the main process function that is called from the ",(0,r.kt)("a",{parentName:"p",href:"/development/specification/solido/entrypoint#entrypoint"},"entrypoint"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub fn process(program_id: &Pubkey, accounts: &[AccountInfo], input: &[u8]) -> ProgramResult {\n")),(0,r.kt)("p",null,"The function simply parses the instruction passed and calls the appropriate processing logic."))}u.isMDXComponent=!0}}]);